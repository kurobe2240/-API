# MySQL接続問題の解決報告

## 問題の解決策

MySQLへの接続問題は、rootユーザーのパスワード設定の誤りによるものでした。調査の結果、以下の対応で解決しました。

## 実施内容

1. **正しいパスワードの特定**
   - テストスクリプト（test_db_simple.php）を作成・修正
   - 異なるパスワード設定（空パスワード、'root'パスワード）でのテスト実行
   - パスワード 'root' で接続成功を確認

2. **設定ファイルの修正**
   - Database.php のパスワード設定を 'root' に変更
   ```php
   private $password = 'root';  // パスワードを 'root' に変更
   ```

3. **動作確認**
   - 修正後、データベースへの接続テストが成功
   - データベース 'task_api' の作成成功
   - タスクテーブルの作成成功
   - サンプルデータの挿入成功

## 技術的詳細

1. **エラー内容**
   ```
   Access denied for user 'root'@'localhost' (using password: NO)
   ```

2. **原因**
   - XAMPPの設定で、MySQLのrootユーザーにパスワード 'root' が設定されていた
   - アプリケーションの設定は空パスワードを想定していた

3. **確認方法**
   - mysqli_connectでの接続テスト
   - PDOを使用した接続テスト
   - さまざまなパスワード設定での接続試行

## 今後の推奨事項

1. **セキュリティ上の注意点**
   - 本番環境では、より強力なパスワードを使用すること
   - パスワードを設定ファイルに直接記述せず、環境変数などで管理することを推奨

2. **アプリケーション設定**
   - 複数環境（開発・テスト・本番）での設定を分けて管理する仕組みを検討

3. **エラー処理**
   - 接続エラー時の詳細なエラーメッセージを表示し、トラブルシューティングを容易にする

## 参考資料
- MySQL公式ドキュメント: パスワードリセット手順
- XAMPPドキュメント: MySQLの初期設定
- PHP PDOマニュアル: データベース接続オプション

## サーバープロセス管理の記録

### 実行していたサーバーの停止

以下のサーバープロセスが動作していたため、停止処理を実施しました：

1. **PHPサーバー停止**
   ```powershell
   Get-Process -Name php* | Stop-Process -Force
   ```

2. **MySQLサーバー停止**
   - ポート3306で動作していたMySQLプロセス（PID 21892）を停止
   ```powershell
   taskkill /PID 21892 /F
   ```

3. **Apacheサーバー停止**
   - ポート80で動作していたhttpd.exe（PID 27072）を停止
   ```powershell
   taskkill /PID 27072 /F
   ```

### ポート使用状況の確認

開発時に使用するポートの状態を確認しました：
```powershell
netstat -ano | Select-String -Pattern "LISTENING"
```

主要な開発ポートの状態：
- ポート80 (HTTP): 解放済み
- ポート8080 (代替HTTP): 解放済み
- ポート3306 (MySQL): 解放済み

これにより、新しい開発プロジェクトでこれらのポートを使用できる状態になりました。

## デプロイ計画とインフラ構成の決定

### デプロイ先とアーキテクチャ

プロジェクトのデプロイ環境として以下の構成を採用することに決定しました：

1. **デプロイプラットフォーム**
   - Renderを使用
   - バックエンドPHP APIをRenderにホスティング
   - 無料枠からスタートし、必要に応じてスケーリング可能

2. **フロントエンドとバックエンドの連携**
   - フロントエンド：Viteを使用したReactアプリケーション
   - バックエンド：PHP APIをRenderにデプロイ
   - 環境変数による接続設定の管理
     ```
     # フロントエンド側の.envファイル例
     VITE_API_URL=https://api-example.onrender.com
     ```
   - フロントエンドからバックエンドAPIを呼び出して、データの取得・操作を実施

3. **ソースコード管理**
   - GitHubリポジトリを使用したバージョン管理
   - `.gitignore`の設定例:
     ```
     # 開発環境
     node_modules/
     .env
     .env.local
     
     # PHPバックエンド
     vendor/
     
     # ビルド成果物
     dist/
     build/
     ```

### 開発環境と本番環境の分離

1. **環境変数管理**
   - 開発環境：ローカルの`.env.development`で開発用APIを指定
     ```
     # 開発環境用
     VITE_API_URL=http://localhost:8080
     ```
   - 本番環境：`.env.production`と、Renderダッシュボードでの環境変数設定
     ```
     # 本番環境用
     VITE_API_URL=https://api-taskmanager.onrender.com
     ```

2. **データベース設定**
   - 開発環境：ローカルXAMPPのMySQL（パスワード: 'root'）
   - 本番環境：Renderが提供するPostgreSQLまたは外部MySQLサービス
   - データベース接続情報は環境変数で管理

3. **デプロイフロー**
   - GitHubのmainブランチへのプッシュでRenderへ自動デプロイ
   - フロントエンドとバックエンドを別々のリポジトリで管理することも検討
   - 開発作業はfeatureブランチで行い、プルリクエストを経てマージ

この構成により、ローカル開発とクラウドデプロイを効率的に行い、本番と開発環境を明確に分離する体制を整えました。MySQL接続問題の解決経験を活かし、環境依存の設定を適切に分離管理することで、今後の開発を円滑に進める基盤が整いました。 